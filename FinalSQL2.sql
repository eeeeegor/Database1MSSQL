USE [DataManagement]
GO

/****** Object:  Table [dbo].[Пользователи]    Script Date: 25.12.2019 18:22:28 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[Пользователи](
	[КодПользователи] [int] IDENTITY(1,1) NOT NULL,
	[ЭлПочта] [varchar](50) NOT NULL,
	[Пароль] [varchar](50) NOT NULL,
	[ФИО] [nvarchar](50) NOT NULL,
	[Роль] [nvarchar](50) NOT NULL,
	[ДатаРождения] [date] NOT NULL
) ON [PRIMARY]
GO

alter table Пользователи
add constraint PK_Пользователи primary key clustered (КодПользователи)
go

create table Отзывы (
	КодОтзывы int identity(1,1),
	КодПользователи int not null,
	Текст nvarchar(250) not null,
	Рейтинг int not null,
)
go






alter table Отзывы
add constraint PK_отзывы primary key clustered (КодОтзывы)

alter table Отзывы
with check add constraint FK_пользователи_отзывы foreign key(КодПользователи)
references Пользователи (КодПользователи)
on update cascade
on delete cascade
go


create table Треки (
	КодТреки int identity(1,1),
	КодЖанры int not null,
	КодПользователи int not null,
	Текст nvarchar(MAX) not null,
	Длительность int not null,
)
go

alter table Треки
add constraint PK_Треки primary key clustered (КодТреки)

alter table Треки
with check add constraint FK_пользователи_треки foreign key(КодПользователи)
references Пользователи (КодПользователи)
on update cascade
on delete cascade
go

alter table Треки
add constraint PK_жанры_треки foreign key(КодЖанры)
references Жанры(КодЖанры)
on update cascade
on delete cascade
go

create table Жанры (
	КодЖанры int identity(1,1),
	Название nvarchar(50) not null,
	СреднийВозрастФаната int not null,
)
go

alter table Жанры 
add constraint PK_жанры primary key clustered (КодЖанры)

create table КонцертныеЗалы (
	КодКонцертныеЗалы int identity(1,1),
	Адрес nvarchar(50) not null,
	Вместимость int not null,
	Название nvarchar(50) not null,
	constraint PK_КонцертныеЗалы primary key clustered (КодКонцертныеЗалы)
)
go

 create table Концерты (
	КодКонцерты int identity(1,1),
	КодКонцертныеЗалы int not null references КонцертныеЗалы (КодКонцертныеЗалы) on delete cascade on update cascade,
	Дата date not null,
	constraint PK_Концерты primary key clustered (КодКонцерты)
	)
	go


create table Фото (
	КодФото int identity(1,1),
	Ссылка nvarchar(250) not null,
	КодКонцерты int not null references Концерты (КодКонцерты) on delete cascade on update cascade,
	constraint PK_фото primary key clustered (КодФото)
)
go

create table ПользователиКонцерты (
	КодКонцерты int not null references Концерты (КодКонцерты) on delete cascade on update cascade,
	КодПользователи int not null references Пользователи (КодПользователи) on delete cascade on update cascade,
)
go

alter table Отзывы 
add constraint Рейтинг check (Рейтинг > 0 and Рейтинг < 11)

alter table Пользователи
add constraint Роль Check (Роль = 'Исполнитель' or Роль = 'Организатор')

alter table Треки
add constraint Длительность check (Длительность > 0 and Длительность < 11)

alter table Жанры 
add constraint СреднийВозрастФаната Check (СреднийВозрастФаната > 0 and СреднийВозрастФаната < 100)

insert into Отзывы (КодПользователи, Текст, Рейтинг) values
('4', '523992', '3'),
('7', '959104', '2'),
('9', '702329', '2'),
('10', '956876', '7'),
('2', '106754', '3'),
('5', '175790', '4'),
('9', '906062', '10'),
('7', '84032', '4'),
('10', '569423', '2'),
('6', '64400', '6'),
('8', '381616', '3'),
('1', '24333', '1'),
('5', '271405', '4'),
('10', '333317', '7'),
('4', '733802', '2'),
('6', '107492', '4'),
('5', '529970', '10'),
('1', '343824', '5'),
('4', '946214', '6'),
('7', '333432', '3'),
('3', '759214', '9'),
('4', '635832', '10'),
('8', '37247', '9'),
('4', '500598', '9'),
('7', '773958', '1'),
('4', '90281', '8'),
('3', '787503', '10'),
('7', '512464', '6'),
('4', '934618', '1'),
('9', '287635', '6'),
('6', '384935', '5'),
('8', '996508', '8'),
('10', '990341', '1'),
('5', '191766', '9'),
('7', '92018', '10'),
('9', '698565', '9'),
('10', '329529', '4'),
('1', '805920', '3'),
('8', '661285', '5'),
('2', '119734', '8'),
('6', '912280', '5'),
('3', '265013', '3'),
('5', '712218', '5'),
('7', '609600', '8'),
('3', '922930', '8'),
('1', '550690', '5'),
('4', '943153', '9'),
('2', '230681', '4'),
('6', '804130', '2'),
('8', '527425', '1'),
('2', '32499', '10'),
('1', '326085', '1'),
('7', '912617', '8'),
('6', '440240', '4'),
('8', '500229', '8'),
('2', '326140', '2'),
('6', '454883', '1'),
('7', '70761', '2'),
('2', '521830', '8'),
('8', '95181', '6'),
('7', '533712', '10'),
('5', '420472', '4'),
('8', '772965', '7'),
('9', '129319', '2'),
('6', '588755', '5'),
('9', '994878', '10'),
('10', '392095', '5'),
('2', '50948', '9'),
('1', '130059', '8'),
('8', '54870', '7'),
('2', '934874', '2'),
('6', '474384', '5'),
('8', '448324', '4'),
('7', '230150', '8'),
('10', '345553', '10'),
('5', '207525', '7'),
('5', '457415', '6'),
('2', '326746', '8'),
('2', '350006', '4'),
('7', '690210', '5'),
('2', '103405', '10'),
('8', '82953', '9'),
('4', '934269', '6'),
('10', '313196', '6'),
('6', '924955', '5'),
('6', '259496', '3'),
('3', '348035', '6'),
('7', '137605', '10'),
('6', '935685', '1'),
('1', '161372', '5'),
('6', '413841', '8'),
('7', '832995', '3'),
('10', '313916', '6'),
('5', '170694', '4'),
('5', '524439', '4'),
('5', '663156', '1'),
('1', '292362', '3'),
('10', '864572', '4'),
('4', '565614', '5'),
('9', '535257', '1'),
('6', '260162', '10'),
('2', '234809', '1'),
('3', '985634', '4'),
('10', '571963', '1'),
('6', '703365', '4'),
('1', '759442', '4'),
('9', '358258', '3'),
('7', '201294', '6'),
('10', '268585', '9'),
('9', '773018', '3'),
('5', '733159', '1'),
('3', '393256', '1'),
('6', '59873', '10'),
('9', '212563', '10'),
('4', '417339', '7'),
('7', '157695', '4'),
('3', '835962', '2'),
('6', '105356', '6'),
('6', '592203', '3'),
('10', '715404', '7'),
('7', '317291', '4'),
('5', '193469', '4'),
('2', '157120', '9'),
('9', '217847', '2'),
('1', '977021', '7'),
('1', '759807', '4'),
('8', '426215', '3'),
('9', '103373', '8'),
('8', '751996', '8'),
('5', '707451', '3'),
('7', '142935', '10'),
('6', '203929', '8'),
('6', '174408', '9'),
('2', '684772', '7'),
('7', '942312', '1'),
('8', '510323', '1'),
('10', '616145', '4'),
('5', '619709', '7'),
('1', '235770', '8'),
('5', '159707', '10'),
('2', '484669', '1'),
('6', '287316', '10'),
('2', '337501', '10'),
('2', '441203', '9'),
('5', '787790', '5'),
('8', '480466', '9'),
('1', '862181', '7'),
('1', '707840', '4'),
('8', '995803', '10'),
('3', '243387', '6'),
('10', '470292', '10'),
('4', '730817', '1'),
('10', '106795', '6'),
('9', '968474', '2'),
('10', '696726', '7'),
('8', '584588', '1'),
('8', '723508', '4'),
('9', '464279', '5'),
('7', '913460', '9'),
('8', '63340', '9'),
('2', '110676', '2'),
('2', '312995', '7'),
('1', '226304', '8'),
('4', '216348', '6'),
('1', '619495', '6'),
('7', '895716', '4'),
('7', '544379', '7'),
('3', '178016', '1'),
('6', '826409', '10'),
('7', '758864', '5'),
('7', '620686', '5'),
('3', '134386', '3'),
('7', '8586', '6'),
('8', '332854', '10'),
('5', '401931', '7'),
('7', '736374', '8'),
('4', '265484', '2'),
('4', '771416', '3'),
('3', '881579', '7'),
('8', '432383', '4'),
('3', '676709', '10'),
('4', '161314', '8'),
('5', '328320', '3'),
('10', '533404', '1'),
('2', '64270', '3'),
('2', '33466', '4'),
('3', '597430', '9'),
('9', '729813', '3'),
('10', '929445', '3'),
('10', '824775', '8'),
('1', '129959', '2'),
('1', '945398', '3'),
('5', '209113', '7'),
('4', '813449', '3'),
('10', '937057', '1'),
('9', '335785', '10'),
('4', '244571', '4'),
('10', '101817', '8'),
('7', '122718', '10'),
('5', '689887', '5'),
('1', '269203', '5'),
('4', '608158', '4'),
('10', '478035', '1'),
('4', '241881', '1'),
('4', '660521', '10'),
('2', '91996', '10'),
('8', '895054', '2'),
('7', '80135', '9'),
('9', '874378', '9'),
('2', '172110', '10'),
('1', '27193', '1'),
('2', '761955', '6'),
('4', '628800', '6'),
('2', '840163', '9'),
('5', '397530', '2'),
('3', '665138', '4'),
('10', '636851', '2'),
('7', '541976', '2'),
('7', '414726', '6'),
('9', '744042', '10'),
('7', '520864', '6'),
('3', '667730', '1'),
('7', '656013', '3'),
('3', '261500', '1'),
('1', '345558', '3'),
('6', '399080', '9'),
('1', '565306', '10'),
('7', '246438', '2'),
('9', '827350', '4'),
('7', '141424', '7'),
('3', '239616', '6'),
('4', '581302', '8'),
('10', '291812', '4'),
('4', '695509', '2'),
('1', '942572', '3'),
('2', '812612', '9'),
('8', '660133', '7'),
('6', '502189', '3'),
('5', '712166', '7'),
('10', '619601', '7'),
('10', '216488', '2'),
('5', '933568', '3'),
('4', '431185', '8'),
('3', '201467', '10'),
('7', '859293', '8'),
('4', '45367', '2'),
('8', '76807', '3'),
('6', '176118', '6'),
('3', '187642', '6'),
('6', '230046', '7'),
('10', '708339', '3'),
('2', '817752', '1'),
('8', '810019', '4'),
('3', '358277', '4'),
('6', '450380', '9'),
('5', '579543', '9'),
('10', '898608', '8'),
('10', '528423', '5'),
('1', '470103', '9'),
('6', '135867', '10'),
('2', '333260', '10'),
('8', '496719', '8'),
('7', '715560', '8'),
('10', '500622', '3'),
('6', '525116', '1'),
('7', '387957', '5'),
('2', '171871', '8'),
('1', '145067', '2'),
('1', '726971', '3'),
('2', '503103', '5'),
('4', '16402', '9'),
('10', '649252', '7'),
('9', '622295', '8'),
('3', '184501', '8'),
('10', '878771', '2'),
('2', '746966', '3'),
('4', '904285', '2'),
('5', '835883', '5'),
('7', '119212', '1'),
('9', '450563', '9'),
('10', '643074', '4'),
('5', '921887', '3'),
('2', '908804', '8'),
('10', '4844', '5'),
('1', '315132', '5'),
('1', '177475', '10'),
('4', '834184', '3'),
('4', '699726', '3'),
('1', '401812', '6'),
('2', '690385', '5'),
('8', '407770', '4'),
('10', '925868', '7'),
('3', '322003', '5'),
('6', '952767', '4'),
('8', '501720', '9'),
('4', '510640', '3'),
('10', '599125', '1'),
('1', '364313', '10'),
('3', '846270', '9'),
('10', '383178', '9'),
('7', '586783', '5'),
('6', '18562', '2'),
('4', '989763', '1'),
('8', '844524', '7'),
('8', '805135', '7'),
('1', '505491', '9'),
('4', '6313', '4'),
('3', '310528', '5'),
('5', '48748', '2'),
('4', '26382', '7'),
('7', '443529', '8'),
('5', '700025', '4'),
('1', '968156', '9'),
('9', '860078', '3'),
('1', '62321', '10'),
('4', '421129', '9'),
('8', '66423', '8'),
('6', '354874', '7'),
('3', '554520', '6'),
('2', '283303', '1'),
('7', '227064', '7'),
('3', '330092', '5'),
('6', '272681', '5'),
('3', '211492', '5'),
('2', '360548', '3'),
('9', '226438', '8'),
('1', '209769', '4'),
('6', '508899', '9'),
('7', '602891', '5'),
('6', '649922', '2'),
('6', '781088', '5'),
('4', '912874', '8'),
('9', '420369', '10'),
('4', '911366', '5'),
('5', '728434', '1'),
('7', '165279', '7'),
('2', '27081', '8'),
('1', '138948', '6'),
('4', '995598', '2'),
('10', '552418', '9'),
('5', '275473', '7'),
('6', '351862', '1'),
('4', '774179', '9'),
('2', '849095', '7'),
('3', '954320', '2'),
('6', '883575', '5'),
('5', '848594', '1'),
('1', '958839', '10'),
('5', '954367', '3'),
('3', '620227', '10'),
('7', '332503', '10'),
('4', '561624', '4'),
('9', '898901', '1'),
('4', '81637', '7'),
('7', '715649', '5'),
('9', '474826', '8'),
('8', '980877', '6'),
('6', '776524', '7'),
('9', '853045', '10'),
('3', '931632', '10'),
('9', '64849', '1'),
('4', '808262', '1'),
('9', '277031', '8'),
('3', '533943', '7'),
('5', '498805', '3'),
('9', '716067', '9'),
('1', '463031', '1'),
('3', '290947', '1'),
('5', '548494', '6'),
('4', '12516', '9'),
('3', '779015', '3'),
('4', '791270', '7'),
('3', '140488', '9'),
('5', '450576', '5'),
('5', '65543', '9'),
('10', '299871', '8'),
('2', '551900', '6'),
('4', '894852', '7'),
('9', '454433', '6'),
('2', '272355', '5'),
('8', '853358', '3'),
('4', '601127', '1'),
('7', '47697', '3'),
('4', '632458', '9'),
('8', '308657', '5'),
('6', '182280', '4'),
('3', '797053', '9'),
('5', '313773', '5'),
('2', '430875', '5'),
('10', '499468', '6'),
('5', '831100', '9'),
('10', '709058', '8'),
('8', '546756', '3'),
('9', '674795', '3'),
('7', '462599', '10'),
('7', '863918', '8'),
('8', '274796', '1'),
('5', '894379', '2'),
('2', '180553', '7'),
('4', '198870', '6'),
('10', '553538', '10'),
('6', '393419', '8'),
('1', '304332', '2'),
('5', '508939', '7'),
('4', '587597', '7'),
('4', '524000', '1'),
('5', '152570', '6'),
('10', '17135', '4'),
('8', '141241', '9'),
('1', '79400', '8'),
('3', '788204', '8'),
('2', '602139', '7'),
('8', '428813', '5'),
('1', '597118', '8'),
('10', '364060', '9'),
('5', '424599', '1'),
('4', '379371', '5'),
('6', '980724', '7'),
('10', '44443', '7'),
('8', '340141', '4'),
('2', '260400', '6'),
('1', '616525', '6'),
('5', '447736', '10'),
('3', '615237', '2'),
('1', '856283', '4'),
('2', '437991', '10'),
('9', '176927', '3'),
('10', '978466', '10'),
('7', '936949', '7'),
('3', '968055', '3'),
('4', '290714', '5'),
('4', '923200', '8'),
('5', '665377', '2'),
('9', '930362', '5'),
('9', '759982', '9'),
('7', '887614', '8'),
('6', '718390', '8'),
('10', '871903', '7'),
('2', '845243', '10'),
('5', '927627', '3'),
('8', '151001', '10'),
('5', '91068', '4'),
('6', '195650', '6'),
('10', '228256', '4'),
('8', '842250', '9'),
('8', '598699', '2'),
('1', '227054', '8'),
('6', '16226', '9'),
('7', '311514', '9'),
('6', '602831', '8'),
('4', '620130', '8'),
('6', '772682', '3'),
('10', '238262', '10'),
('3', '166600', '4'),
('8', '514155', '2'),
('9', '689095', '4'),
('10', '373291', '8'),
('7', '902814', '3'),
('2', '459705', '3'),
('1', '176695', '2'),
('6', '106330', '3'),
('3', '12764', '3'),
('4', '250180', '1'),
('3', '387555', '1'),
('10', '462211', '1'),
('8', '566161', '3'),
('5', '61637', '6'),
('8', '318793', '8'),
('5', '641038', '10'),
('2', '457111', '2'),
('6', '349087', '8'),
('1', '353899', '10'),
('5', '67838', '1'),
('8', '759388', '10'),
('5', '888113', '4'),
('9', '496668', '2'),
('2', '839684', '6'),
('8', '425624', '4'),
('3', '677486', '5'),
('10', '681325', '7'),
('7', '800272', '6'),
('3', '450169', '1'),
('1', '65370', '5'),
('6', '511508', '9'),
('5', '422485', '4'),
('3', '513963', '5'),
('4', '479911', '5'),
('9', '477808', '3'),
('9', '486057', '8'),
('3', '112242', '7'),
('10', '605041', '4'),
('1', '678425', '4'),
('9', '178604', '10'),
('1', '220863', '1'),
('4', '379753', '7'),
('10', '780532', '10'),
('1', '440398', '3'),
('8', '593399', '5'),
('10', '745870', '6'),
('3', '176072', '6'),
('1', '456937', '4'),
('1', '884648', '10'),
('8', '690983', '8'),
('2', '341504', '6'),
('4', '659467', '2'),
('8', '683037', '4'),
('3', '241824', '5'),
('8', '472714', '8'),
('7', '921007', '7'),
('3', '773396', '4'),
('2', '704210', '9'),
('8', '960159', '10'),
('7', '169750', '4'),
('3', '814805', '2'),
('10', '164442', '3'),
('10', '856674', '4'),
('8', '351582', '2'),
('10', '721708', '10'),
('3', '937747', '8'),
('4', '508980', '5'),
('5', '892794', '2'),
('2', '396333', '8'),
('2', '459839', '9'),
('9', '349333', '8'),
('4', '116738', '9'),
('5', '550491', '5'),
('9', '332143', '10'),
('2', '769039', '6'),
('3', '840441', '6'),
('10', '661656', '2'),
('1', '536576', '10'),
('5', '890073', '4'),
('1', '216860', '1'),
('4', '268623', '9'),
('8', '637888', '9'),
('1', '574290', '9'),
('4', '152248', '8'),
('6', '155701', '5'),
('8', '340795', '6'),
('6', '854461', '10'),
('6', '950978', '1'),
('7', '930337', '2'),
('4', '866126', '9'),
('8', '760819', '4'),
('9', '818569', '10'),
('7', '600185', '4'),
('4', '93928', '2'),
('5', '528221', '8'),
('7', '663055', '10'),
('2', '44', '5'),
('9', '694262', '2'),
('5', '949680', '10'),
('9', '111953', '3'),
('10', '48058', '9'),
('2', '510628', '6'),
('7', '784738', '8'),
('5', '856756', '1'),
('10', '316236', '9'),
('1', '633048', '7'),
('4', '551413', '7'),
('10', '129172', '10'),
('6', '591680', '8'),
('9', '591513', '9'),
('4', '845275', '6'),
('1', '558692', '2'),
('9', '61816', '4'),
('1', '808579', '4'),
('9', '817675', '1'),
('4', '882979', '5'),
('1', '768897', '9'),
('4', '804116', '4'),
('7', '435848', '3'),
('3', '190310', '6'),
('5', '613454', '4'),
('6', '154588', '7'),
('10', '973565', '10'),
('10', '967577', '2'),
('3', '929612', '6'),
('4', '182107', '9'),
('2', '47907', '6'),
('7', '769761', '6'),
('5', '414589', '4'),
('3', '752142', '2'),
('5', '309828', '3'),
('9', '449952', '8'),
('10', '912197', '4'),
('8', '971748', '10'),
('5', '281806', '2'),
('7', '411013', '1'),
('6', '283456', '10'),
('6', '153837', '10'),
('4', '545929', '9'),
('7', '932178', '6'),
('5', '332661', '10'),
('3', '704830', '5'),
('7', '810336', '4'),
('8', '948290', '5'),
('3', '81341', '4'),
('3', '511625', '5'),
('2', '163801', '9'),
('5', '949671', '1'),
('1', '47573', '10'),
('2', '850696', '9'),
('7', '797143', '2'),
('2', '55793', '1'),
('7', '787777', '6'),
('8', '521693', '9'),
('4', '240592', '3'),
('3', '798925', '3'),
('8', '237503', '1'),
('3', '571866', '9'),
('2', '703512', '2'),
('7', '498982', '6'),
('7', '320869', '1'),
('10', '892850', '1'),
('4', '670325', '9'),
('8', '329610', '1'),
('2', '775085', '8'),
('3', '933018', '6'),
('1', '144035', '5'),
('6', '517486', '5'),
('5', '630052', '2'),
('6', '117008', '5'),
('1', '905708', '9'),
('3', '793428', '10'),
('5', '297133', '1'),
('5', '398908', '1'),
('10', '138133', '4'),
('6', '651038', '7'),
('3', '273087', '2'),
('5', '696589', '7'),
('3', '145436', '6'),
('10', '41641', '2'),
('10', '953135', '10'),
('4', '705260', '8'),
('5', '871244', '6'),
('9', '58449', '3'),
('9', '339414', '7'),
('7', '851447', '10'),
('5', '752600', '1'),
('4', '101151', '8'),
('5', '235113', '3'),
('1', '909957', '5'),
('10', '221745', '8'),
('9', '541769', '10'),
('2', '289178', '1'),
('7', '665797', '6'),
('10', '253737', '7'),
('9', '683798', '4'),
('6', '922476', '10'),
('7', '259187', '6'),
('1', '671466', '4'),
('3', '960060', '8'),
('7', '116447', '6'),
('5', '176516', '4'),
('8', '237219', '3'),
('5', '213147', '7'),
('10', '401372', '8'),
('8', '854977', '9'),
('3', '372122', '7'),
('10', '810729', '9'),
('8', '354430', '10'),
('9', '128169', '2'),
('3', '658707', '5'),
('8', '305348', '1'),
('3', '235181', '7'),
('2', '194701', '7'),
('2', '167337', '9'),
('6', '82143', '10'),
('9', '414222', '6'),
('8', '769260', '4'),
('8', '23188', '8'),
('8', '246950', '10'),
('10', '763617', '8'),
('9', '245279', '4'),
('7', '558811', '5'),
('1', '795427', '4'),
('9', '145394', '7'),
('9', '277149', '4'),
('9', '544089', '7'),
('8', '701299', '6'),
('7', '780240', '1'),
('1', '974588', '9'),
('8', '254158', '6'),
('2', '895867', '2'),
('2', '242058', '8'),
('4', '370473', '6'),
('10', '305621', '3'),
('7', '595465', '4'),
('7', '505172', '3'),
('8', '431151', '1'),
('6', '964367', '2'),
('9', '814734', '5'),
('7', '421333', '8'),
('10', '683996', '2'),
('7', '256234', '2'),
('5', '218921', '4'),
('7', '802157', '1'),
('10', '665097', '5'),
('7', '805570', '4'),
('9', '612921', '5'),
('7', '990929', '3'),
('4', '316192', '4'),
('4', '648276', '4'),
('1', '832225', '3'),
('3', '636828', '10'),
('5', '640596', '6'),
('8', '887427', '1'),
('1', '151296', '5'),
('1', '607129', '3'),
('5', '540215', '6'),
('5', '197730', '5'),
('2', '357232', '5'),
('6', '408711', '10'),
('9', '801945', '2'),
('8', '879322', '5'),
('6', '947371', '6'),
('9', '223636', '2'),
('1', '150318', '6'),
('2', '622396', '2'),
('7', '88110', '1'),
('7', '258297', '8'),
('6', '995107', '3'),
('6', '374372', '6'),
('7', '776298', '2'),
('1', '554045', '5'),
('4', '757645', '8'),
('2', '124443', '2'),
('9', '646811', '2'),
('4', '886659', '1'),
('10', '173702', '5'),
('4', '404618', '9'),
('10', '314868', '4'),
('9', '759644', '10'),
('6', '920803', '2'),
('5', '106655', '2'),
('7', '131838', '7'),
('9', '142083', '4'),
('1', '90706', '1'),
('10', '239941', '1'),
('10', '287916', '6'),
('5', '40816', '7'),
('3', '519254', '5'),
('8', '152002', '10'),
('3', '832593', '5'),
('1', '982196', '8'),
('5', '159136', '5'),
('8', '428283', '1'),
('2', '505696', '5'),
('1', '521734', '2'),
('6', '494538', '3'),
('8', '648379', '5'),
('7', '452660', '4'),
('3', '64490', '9'),
('6', '182468', '3'),
('9', '700485', '1'),
('5', '293093', '2'),
('3', '441317', '7'),
('1', '270066', '1'),
('6', '194020', '7'),
('2', '901569', '5'),
('8', '143109', '7'),
('2', '899695', '5'),
('8', '794806', '4'),
('9', '501116', '9'),
('5', '378658', '8'),
('7', '564882', '4'),
('3', '302350', '1'),
('1', '260666', '10'),
('10', '757308', '3'),
('5', '953162', '10'),
('10', '262180', '6'),
('6', '615758', '3'),
('7', '324974', '6'),
('7', '261614', '4'),
('7', '781611', '3'),
('6', '750869', '5'),
('1', '763889', '1'),
('4', '301206', '9'),
('7', '795990', '8'),
('3', '574299', '4'),
('2', '516392', '6'),
('6', '378075', '2'),
('1', '401601', '6'),
('7', '104410', '6'),
('1', '763012', '3'),
('7', '682246', '8'),
('6', '156987', '4'),
('10', '962854', '2'),
('6', '151516', '4'),
('6', '485876', '6'),
('6', '20055', '3'),
('10', '994475', '5'),
('9', '185643', '10'),
('1', '686026', '4'),
('3', '435866', '5'),
('7', '682191', '1'),
('9', '852709', '2'),
('2', '589895', '8'),
('4', '958777', '6'),
('8', '442302', '9'),
('8', '29896', '1'),
('3', '162068', '10'),
('7', '562473', '5'),
('10', '870315', '3'),
('10', '952602', '8'),
('8', '72555', '8'),
('8', '615624', '2'),
('3', '250139', '7'),
('7', '267772', '3'),
('5', '496955', '8'),
('10', '770536', '5'),
('3', '410098', '7'),
('6', '522565', '8'),
('3', '937561', '4'),
('7', '270282', '1'),
('8', '345091', '6'),
('4', '86228', '5'),
('2', '435659', '1'),
('9', '440210', '5'),
('2', '887018', '9'),
('5', '459280', '9'),
('7', '768171', '7'),
('10', '736912', '6'),
('9', '512493', '9'),
('5', '738120', '2'),
('2', '804159', '10'),
('5', '437517', '5'),
('8', '197797', '1'),
('4', '35849', '5'),
('8', '610891', '10'),
('5', '395543', '2'),
('9', '701891', '5'),
('7', '829271', '8'),
('5', '513906', '10'),
('3', '361601', '3'),
('3', '980771', '3'),
('6', '413947', '10'),
('9', '193040', '9'),
('3', '370585', '2'),
('6', '349203', '6'),
('1', '769583', '9'),
('8', '993718', '4'),
('2', '978069', '5'),
('2', '82684', '10'),
('2', '244978', '4'),
('4', '434489', '10'),
('8', '616255', '3'),
('2', '616831', '7'),
('7', '908791', '1'),
('10', '62309', '4'),
('2', '91682', '10'),
('4', '265327', '1'),
('9', '816953', '10'),
('2', '564464', '1'),
('3', '79541', '5'),
('6', '485365', '3'),
('3', '115235', '7'),
('2', '272499', '2'),
('6', '154602', '8'),
('6', '852676', '5'),
('5', '503002', '7'),
('5', '541977', '5'),
('6', '904050', '9'),
('10', '631185', '3'),
('9', '186464', '4'),
('9', '800423', '2'),
('1', '139304', '9'),
('8', '651165', '9'),
('10', '14558', '6'),
('3', '680980', '8'),
('8', '723911', '10'),
('2', '415926', '10'),
('7', '362142', '7'),
('2', '190077', '4'),
('10', '982913', '8'),
('6', '804246', '10'),
('9', '606642', '5'),
('10', '754695', '9'),
('9', '211558', '7'),
('6', '578894', '9'),
('9', '86555', '10'),
('9', '195116', '4'),
('7', '897748', '8'),
('10', '163752', '9'),
('5', '569850', '8'),
('9', '801643', '4'),
('9', '920143', '1'),
('9', '106289', '3'),
('7', '684565', '4'),
('1', '743928', '3'),
('8', '801537', '2'),
('10', '683248', '1'),
('7', '286364', '3'),
('7', '906948', '3'),
('5', '562335', '4'),
('3', '486750', '8'),
('9', '498103', '6'),
('3', '83315', '8'),
('7', '824383', '7'),
('4', '572984', '9'),
('9', '206820', '5'),
('10', '729128', '2'),
('10', '999930', '7'),
('10', '223112', '7'),
('9', '531120', '7'),
('1', '939739', '1'),
('3', '676676', '3'),
('3', '203163', '10'),
('1', '141789', '4'),
('4', '326666', '3'),
('7', '407836', '3'),
('4', '768957', '7'),
('6', '548774', '8'),
('2', '948606', '3'),
('6', '120881', '10'),
('2', '941685', '4'),
('3', '139640', '5'),
('9', '850551', '9'),
('4', '56836', '5'),
('7', '806311', '3'),
('5', '663683', '6'),
('9', '232238', '2'),
('3', '361354', '1'),
('2', '238812', '1'),
('1', '354837', '4'),
('5', '277929', '2'),
('3', '420400', '4'),
('9', '812926', '6'),
('8', '914897', '4'),
('8', '814835', '10'),
('2', '50696', '9'),
('9', '269710', '10'),
('5', '735691', '4'),
('8', '295825', '7'),
('10', '757635', '7'),
('1', '209775', '3'),
('6', '792295', '5'),
('7', '276650', '9'),
('4', '755007', '4'),
('3', '538891', '7'),
('4', '990018', '10'),
('4', '853023', '4'),
('7', '67953', '2'),
('6', '574214', '7'),
('1', '879046', '6'),
('6', '566736', '5'),
('2', '499271', '6'),
('8', '34089', '9'),
('4', '538550', '4'),
('5', '715259', '10'),
('4', '991367', '9'),
('2', '729434', '1'),
('2', '331030', '4'),
('1', '907293', '9'),
('3', '723804', '9'),
('4', '70103', '9'),
('1', '642395', '6'),
('2', '409809', '3'),
('7', '973831', '1'),
('1', '904869', '8'),
('9', '340727', '3'),
('10', '289614', '2'),
('6', '195530', '4'),
('1', '917366', '6'),
('5', '733821', '3'),
('4', '213819', '4'),
('9', '237222', '5'),
('4', '408594', '6'),
('8', '106812', '4'),
('4', '33647', '2'),
('3', '347776', '6'),
('5', '414296', '10'),
('1', '157637', '10'),
('8', '529254', '9'),
('1', '990203', '1'),
('6', '281289', '6'),
('6', '291199', '6'),
('3', '844918', '4'),
('7', '850122', '4'),
('7', '208134', '5'),
('8', '722278', '6'),
('4', '980222', '4'),
('9', '980289', '10'),
('10', '391936', '10'),
('6', '62606', '2'),
('4', '248688', '3'),
('1', '246255', '7'),
('6', '385370', '1'),
('5', '531893', '1'),
('5', '245743', '8'),
('2', '929558', '5'),
('3', '204307', '9'),
('10', '210355', '4'),
('1', '326814', '8'),
('8', '591634', '9'),
('4', '777591', '5'),
('3', '164744', '10'),
('8', '779311', '9')

--ИНДЕКСЫ

create index Nindex on Отзывы(КодОтзывы)
drop index Nindex on Отзывы
select * from Отзывы

alter table Концерты 
add КоличествоФото int null

--ТРИГГЕРЫ

create trigger КоличествоФото
on Фото
for insert 
as if @@ROWCOUNT = 0 return                                          --ТРИГГЕР ДОБАВЛЯЕТ В ПОЛЕ КОЛИЧЕСТВОФОТО +1 ЕСЛИ ДОБАВЛЯЕТСЯ СТРОКА В ТАБЛИЧКУ ФОТО.
update Концерты
set КоличествоФото = КоличествоФото + 1
from Концерты к join inserted i on к.КодКонцерты = i.КодКонцерты





--ПРОЦЕДУРЫ



create proc УдалениеКонцертныеЗалы
@КодКонцертныеЗалы int                --ПРОЦЕДУРА УДАЛЯЕТ ЗАПИСЬ В КОНЦЕРТНЫХ ЗАЛАХ
as
delete from КонцертныеЗалы Where КодКонцертныеЗалы = @КодКонцертныеЗалы
go

exec УдалениеКонцертныеЗалы @КодКонцертныеЗалы = 11   

create proc ДобавлениеПользователи 
@КодПользователи int,
@ЭлПочта varchar(50),
@Пароль varchar(50),
@ФИО nvarchar(50),
@Роль nvarchar(50),
@ДатаРождения date
as insert into Пользователи values(@ЭлПочта,@Пароль,@ФИО,@Роль,@ДатаРождения)
go

exec ДобавлениеПользователи 
@КодПользователи = 12,
@ЭлПочта = 'proc@procrudы',
@Пароль = 'asdfgessgы',                           --пример работы процедуры 
@ФИО = 'Процедуров Процедурsssы',
@Роль = 'Исполнитель',
@ДатаРождения = '2005-03-02' 


create proc ОбновлениеПользователи
@КодПользователи int,
@ЭлПочта varchar(50),
@Пароль varchar(50),
@ФИО nvarchar(50),
@Роль nvarchar(50),
@ДатаРождения date
as
update Пользователи set 
ЭлПочта = @ЭлПочта,
Пароль = @Пароль,
ФИО = @ФИО,
Роль = @Роль,
ДатаРождения = @ДатаРождения
where КодПользователи = @КодПользователи

exec ОбновлениеПользователи 
@КодПользователи = 11,
@ЭлПочта = 'proc@procru1',
@Пароль = 'asdfgeg1',
@ФИО = 'Процедуров Процедур1',
@Роль = 'Исполнитель',
@ДатаРождения = '2000-03-02' 






create proc ВыборкаКонцертныеЗалы 
@a int as
if @a= 0 select * from КонцертныеЗалы where Вместимость < 1000
else 
select * from КонцертныеЗалы where Вместимость > 1000

exec ВыборкаКонцертныеЗалы @a=2



create proc СменаРоли
@Роль nvarchar(50),@КодПользователи int as                          -- ЛОВИТ НЕПРАВИЛЬНЫЙ ФОРМАТ РОЛИ
begin try 
update Пользователи set Роль = @Роль where КодПользователи = @КодПользователи 
end try
begin catch 
print('Ошибка, неверный формат роли')
end catch

exec СменаРоли @Роль ='Исполитель' , @КодПользователи = 2

-- ФУНКЦИИ

create function qwerty ( @КодКонцерты int)
returns int
as
begin                          ----ВОЗВРАЩАЕТ КОЛ-ВО ФОТО ЛЮБОГО КОНЦЕРТА
declare @c int                                                                      
set @c =(select КоличествоФото from Концерты where КодКонцерты = @КодКонцерты)
return(@c)
end
go

create function zxc (@КодТреки int)
returns int
as
begin                          -----ВОЗВРАЩАЕТ ДЛИТЕЛЬНОСТЬ ЛЮБОГО ТРЕЦКА
declare @b int
set @b = (select Длительность from Треки where КодТреки = @КодТреки)                  
return(@b)
end
go


--ПРЕДСТАВЛЕНИЯ

drop view firstone

create view firstone as
select Пользователи.ФИО as Имя,
		Треки.КодТреки as КодТрека,
		Жанры.Название as Жанр
from Треки inner join Пользователи on Треки.КодПользователи = Пользователи.КодПользователи
inner join Жанры on Треки.КодЖанры = Жанры.КодЖанры 
where exists(select ЭлПочта from Пользователи where ФИО is not null) 
group by Жанры.Название, Пользователи.ФИО, Треки.КодТреки
Having Жанры.Название = 'Хип-хоп'


create view secondone as
select Пользователи.ФИО as Имя,
		Отзывы.Рейтинг as Рейтинг
from Пользователи inner join Отзывы on Пользователи.КодПользователи = Отзывы.КодПользователи



set statistics time on


 --ПРОСТОЙ ЗАПРОС С УСЛОВИЕМ И ФОРМУЛАМИ
 select КодТреки, КодПользователи
 from Треки
 where Длительность > 2

 select КодКонцерты 
 from Концерты 
 where КоличествоФото < 3

 --Запрос с коррелированным подзапросом в селеект
 select КодКонцерты, КоличествоФото - (select avg(КоличествоФото) from
 Концерты ) from Концерты 

 -- Запрос с подзапросом в from
 select КодПользователи, ФИО from
 (select КодПользователи, ФИО from Пользователи where ДатаРождения > '2000-01-01')

 --Запрос с агрегированием и выражением JOIN, включающим не менее 3 таблиц/выражений,HAVING, EXISTS, Проверка на NULL 
 select Пользователи.ФИО as Имя,
		Треки.КодТреки as КодТрека,
		Жанры.Название as Жанр
from Треки inner join Пользователи on Треки.КодПользователи = Пользователи.КодПользователи
inner join Жанры on Треки.КодЖанры = Жанры.КодЖанры 
where exists(select ЭлПочта from Пользователи where ФИО is not null) 
group by Жанры.Название, Пользователи.ФИО, Треки.КодТреки
Having Жанры.Название = 'Хип-хоп'

--Запрос с агрегированием и выражением JOIN, включающим не менее 2 таблиц 
select Пользователи.ФИО as Имя,
		Отзывы.Рейтинг as Рейтинг
from Пользователи inner join Отзывы on Пользователи.КодПользователи = Отзывы.КодПользователи






 


















